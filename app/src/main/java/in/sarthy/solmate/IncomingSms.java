package in.sarthy.solmate;import android.content.BroadcastReceiver;import android.content.Context;import android.content.Intent;import android.os.Bundle;import android.os.Handler;import android.util.Log;import android.widget.Toast;import android.telephony.SmsManager;import android.telephony.SmsMessage;/** * Created by saurabh on 28/12/15. */public class IncomingSms extends BroadcastReceiver {    // Get the object of SmsManager    final SmsManager sms = SmsManager.getDefault();    Context mContext;    public void onReceive(Context context, Intent intent) {        // Retrieves a map of extended data from the intent.        final Bundle bundle = intent.getExtras();        mContext = context;        try {            if (bundle != null) {                final Object[] pdusObj = (Object[]) bundle.get("pdus");                for (int i = 0; i < pdusObj.length; i++) {                    SmsMessage currentMessage = SmsMessage.createFromPdu((byte[]) pdusObj[i]);                    String phoneNumber = currentMessage.getDisplayOriginatingAddress();                    String senderNum = phoneNumber;                    String message = currentMessage.getDisplayMessageBody();                    // Show Alert                    int duration = Toast.LENGTH_LONG;                    try {                        if (senderNum.substring(senderNum.indexOf("-")+1).equals("SARTHY"))                        {                            if(otp_final.fa.hasWindowFocus()) {                                Intent intent2 = new Intent(context, otp_final.class);                                intent2.putExtra("otp", message.substring(message.indexOf(": ") + 2, message.indexOf(": ") + 8));                                intent2.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                                intent2.putExtras(otp_final.fa.getIntent().getExtras());                                otp_final.fa.finish();                                otp_final.fa.overridePendingTransition(0,0);                                context.startActivity(intent2);                                otp_final.otp.setText( message.substring(message.indexOf(": ") + 2, message.indexOf(": ") + 8));                            }                            else if(otp_final2.fa.hasWindowFocus()) {                                Intent intent2 = new Intent(context, otp_final.class);                                intent2.putExtra("otp", message.substring(message.indexOf(": ") + 2, message.indexOf(": ") + 8));                                intent2.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                                intent2.putExtras(otp_final.fa.getIntent().getExtras());                                otp_final.fa.finish();                                otp_final.fa.overridePendingTransition(0,0);                                context.startActivity(intent2);//                                otp_final2.otp.setText( message.substring(message.indexOf(": ") + 2, message.indexOf(": ") + 8));                            }                        }                }catch (Exception e) {                        Log.e("error", e.toString());                    }                    } // end for loop            } // bundle is null        } catch (Exception e) {            Log.e("SmsReceiver", "Exception smsReceiver" + e);        }    }}